# 브라우저 렌더링

## 브라우저 기본 구조

1. 사용자 인터페이스: 주소 표시줄, 이전 / 다음 버튼, 북마크 메뉴 등. 요청한 페이지를 보여주는 창을 젱외한 나머지 모든 부분
2. 브라우저 엔진: 사용자 인테페이스와 렌더링 엔진 사이의 동작을 제어
3. 렌더링 엔진: 요청한 콘텐츠를 표시. ex) HTML을 요청하면 HTML과 CSS를 팟깅하고 화면에 표시
4. 통신: HTTP 요청과 간튼 네트워크 호출에 사용됨, 플랫폼 독립적인 인터페이스이고 각 플랫폼 하부에서 실행됨
5. UI 백엔드: 콤보 박스와 창 같은 기본적인 장치를 그림. 플랫폼에서 명시하지 않은 일반적인 인터페이스로서, OS 사용자 인터페이스 체계를 사용.
6. 자바스크립트 해석기: 자바스크립트 코드를 해석하고 실행
7. 자료 저장소: 자료를 저장하는 계층.

![image](https://user-images.githubusercontent.com/60173534/226910889-802deba3-c62e-4581-81c3-ea33325059f2.png)

## 렌더링 엔진

> 렌더링 엔진의 역할은 요청받은 내용을 브라우저 화면에 표시하는 일

-  HTML, XML 문서와 이미지를 표시할 수 있다.

### 브라우저 렌더링 과정

1. HTML 파일과 CSS 파일을 파싱해서 각각 Tree를 만든다 (Parsing)

-  HTML은 DOM Tree, CSS는 CSSOM Tree로 구성된다.
   ![image](https://user-images.githubusercontent.com/60173534/226913097-400bf62b-fce8-4c16-996c-bb0ec1fa6165.png)

2. 두 Tree를 결합하여 Rendering Tree를 만든다 (Style)

-  Parsing 단계에서 생성된 DOM Tree와 CSSOM Tree를 결합하여 Render Tree를 생성한다. (실제 화면에 그려질 Tree)
   ![image](https://user-images.githubusercontent.com/60173534/226913303-3fd54809-abc6-46ad-8814-f34bec3b45cc.png)

3. Rendering Tree에서 각 노드의 위치와 크기를 계산한다. (Layout)

-  Render Tree를 화면에 어떨게 배치할 것인지 노드의 정확한 위치와 크기를 계산한다.
-  루트부터 노드를 순회하며 노드의 정확한 크기와 위치를 계산하고 Render Tree에 반영한다.

4. 계산된 값을 이용해 각 노드를 화면상의 실제 픽셀로 변환하고, 레이어를 만든다 (Paint)

-  Layout 단계에서 계산된 값을 이용해 Render Tree의 각 노드를 화면상의 실제 픽셀로 변환한다.
-  픽셀로 변환된 결과는 하나의 레이어가 아니라 여러개의 레이어로 관리된다.

5. 레이어를 합성하여 실제 화면에 나타낸다. (Composite)

-  Paint 단계에서 생성된 레이어를 합성하여 실제 화면에 나타낸다.

## 리플로우과 리페인트

-  브라우저 로딩 과정 중 스타일 이후 과정 (스타일 -> 레이아웃 -> 페인트 -> 합성)을 렌더링이라고 하는데 해당 과정은 반복하여 발생할 수 있다.


### 리플로우

-  스타일 단계에서 구성되는 렌더트리는 자바스크립트에 의해 DOM 트리, CSSOM 트리가 변경될 때 마다 재구성된다.
-  DOM이 추가/삭제되거나 요소에 기하학적인 영향(높이, 너비, 위치)을 주는 CSS 속성값이 변경되는 경우. 렌더트리가 재구성된다.
-  레이아웃 이후 과정을 다시 수행는 것을 리플로우라고 한다.
-  CSS 속성값 : `height`, `width`, `left`, `top`, `font-size`, `line-height` 등

![image](https://user-images.githubusercontent.com/60173534/226915246-f9a9c3bc-372f-491c-8331-e8a296c59e9f.png)

### 리페인트

-  리플로우는 기하학적인 영향을 주는 CSS 속성값이 변경할 때 발생한다.
   반대로 영향을 주지 않는 CSS 속성값을 변경하면 레이아웃 과정을 건넊뀐다.
-  즉, 레이아웃 과정을 건너뛰고 페인트 과정만 수행하는 것을 리페인트라고 한다.
-  CSS 속성값 : `background-color`, `color`, `visibility`, `text-decoration` 등

![image](https://user-images.githubusercontent.com/60173534/226915255-21e9e18d-d406-4b73-8340-184ddde8fa1f.png)

## 면접 질문

1. `Q. 브라우저 동작 방식에 대해 설명해보세요.`

-  A. 브라우저는 사용자가 입력한 URL을 서버에 요청하고, 서버에서 응답으로 HTML, CSS, JavaScript 등의 리소스를 전송받습니다. 이후 브라우저는 HTML을 파싱하고 DOM 트리를 만들어 렌더링 엔진에 전달합니다. 렌더링 엔진은 DOM 트리와 CSSOM 트리를 조합하여 레이아웃을 생성하고, 그림을 그립니다.

2. `Q. 브라우저의 렌더링 과정에 대해 설명해보세요.`

-  A. 브라우저의 렌더링 과정은 크게 파싱과 렌더링으로 나뉩니다. 먼저 HTML 문서를 파싱하여 DOM(Document Object Model) 트리를 만들고, CSS 파일을 파싱하여 CSSOM(CSS Object Model) 트리를 만듭니다. 이후 DOM과 CSSOM을 조합하여 렌더링 트리(Rendering Tree)를 만듭니다. 렌더링 트리는 브라우저 화면에 실제로 보여지는 노드들로 구성되며, 각 노드에는 스타일 정보가 적용되어 있습니다. 마지막으로 렌더링 트리를 이용하여 브라우저 화면에 그림을 그립니다.

3. `Q. 브라우저의 렌더링 엔진에 대해 설명해보세요.`

-  A. 브라우저의 렌더링 엔진은 HTML, CSS 등의 문서를 파싱하고 렌더링하는 역할을 담당합니다. 대표적인 렌더링 엔진으로는 WebKit, Blink, Gecko 등이 있습니다.

4. `Q. 브라우저에서 JavaScript가 어떻게 동작하는지 설명해보세요.`

-  A. 브라우저에서 JavaScript는 HTML 문서에 포함된 \<script> 태그를 통해 실행됩니다. JavaScript 엔진은 스크립트를 파싱하고, 실행 가능한 바이트코드로 컴파일합니다. 실행 가능한 코드는 메모리에 올라가고, 브라우저의 자바스크립트 엔진이 관리합니다.

5. `Q. 브라우저의 쿠키와 세션에 대해 설명해보세요.`

-  A. 쿠키는 서버에서 브라우저로 전송되어 저장되는 작은 데이터 조각입니다. 브라우저는 쿠키를 저장하고, 쿠키가 필요한 서버에 요청할 때마다 쿠키를 함께 전송합니다. 세션은 서버 측에서 유지되는 정보를 의미합니다. 세션 정보는 쿠키에 저장될 수 있으며, 쿠키보다 보안성이 높습니다.

6. `Q. 브라우저의 크로스 도메인 이슈에 대해 설명해보세요.`

-  A. 브라우저는 보안상의 이유로 한 도메인에서 다른 도메인으로의 자원 요청을 제한합니다. 이를 Same-Origin Policy라고 합니다. 크로스 도메인 요청을 허용하려면 CORS (Cross-Origin Resource Sharing)를 사용하여 요청 헤더에 특정 허용 도메인을 명시해야 합니다.

7. `Q. 브라우저의 이벤트 루프에 대해 설명해보세요.`

-  A. 브라우저에서 이벤트 루프는 비동기 작업을 처리하는 메커니즘입니다. 브라우저는 이벤트 큐에 이벤트를 넣고, 이벤트 루프는 현재 실행 중인 태스크가 없을 때, 이벤트 큐에서 이벤트를 꺼내 처리합니다.

브라우저에서의 렌더링 과정에 대해 설명해주세요.
브라우저 렌더링 과정 중 HTML, CSS, JavaScript이 어떤 역할을 하는지 설명해주세요.
브라우저에서의 렌더링 최적화 방법에 대해 설명해주세요.
브라우저 렌더링 과정에서의 Reflow와 Repaint에 대해 설명해주세요.
브라우저 렌더링 과정에서의 Critical Rendering Path에 대해 설명해주세요.
