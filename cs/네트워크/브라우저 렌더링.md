# 브라우저 렌더링

## 브라우저 기본 구조

1. 사용자 인터페이스: 주소 표시줄, 이전 / 다음 버튼, 북마크 메뉴 등. 요청한 페이지를 보여주는 창을 젱외한 나머지 모든 부분
2. 브라우저 엔진: 사용자 인테페이스와 렌더링 엔진 사이의 동작을 제어
3. 렌더링 엔진: 요청한 콘텐츠를 표시. ex) HTML을 요청하면 HTML과 CSS를 팟깅하고 화면에 표시
4. 통신: HTTP 요청과 간튼 네트워크 호출에 사용됨, 플랫폼 독립적인 인터페이스이고 각 플랫폼 하부에서 실행됨
5. UI 백엔드: 콤보 박스와 창 같은 기본적인 장치를 그림. 플랫폼에서 명시하지 않은 일반적인 인터페이스로서, OS 사용자 인터페이스 체계를 사용.
6. 자바스크립트 해석기: 자바스크립트 코드를 해석하고 실행
7. 자료 저장소: 자료를 저장하는 계층.

![image](https://user-images.githubusercontent.com/60173534/226910889-802deba3-c62e-4581-81c3-ea33325059f2.png)

## 렌더링 엔진

> 렌더링 엔진의 역할은 요청받은 내용을 브라우저 화면에 표시하는 일

-  HTML, XML 문서와 이미지를 표시할 수 있다.

### 브라우저 렌더링 과정

1. HTML 파일과 CSS 파일을 파싱해서 각각 Tree를 만든다 (Parsing)

-  HTML은 DOM Tree, CSS는 CSSOM Tree로 구성된다.
   ![image](https://user-images.githubusercontent.com/60173534/226913097-400bf62b-fce8-4c16-996c-bb0ec1fa6165.png)

2. 두 Tree를 결합하여 Rendering Tree를 만든다 (Style)

-  Parsing 단계에서 생성된 DOM Tree와 CSSOM Tree를 결합하여 Render Tree를 생성한다. (실제 화면에 그려질 Tree)
   ![image](https://user-images.githubusercontent.com/60173534/226913303-3fd54809-abc6-46ad-8814-f34bec3b45cc.png)

3. Rendering Tree에서 각 노드의 위치와 크기를 계산한다. (Layout)

-  Render Tree를 화면에 어떨게 배치할 것인지 노드의 정확한 위치와 크기를 계산한다.
-  루트부터 노드를 순회하며 노드의 정확한 크기와 위치를 계산하고 Render Tree에 반영한다.

4. 계산된 값을 이용해 각 노드를 화면상의 실제 픽셀로 변환하고, 레이어를 만든다 (Paint)

-  Layout 단계에서 계산된 값을 이용해 Render Tree의 각 노드를 화면상의 실제 픽셀로 변환한다.
-  픽셀로 변환된 결과는 하나의 레이어가 아니라 여러개의 레이어로 관리된다.

5. 레이어를 합성하여 실제 화면에 나타낸다. (Composite)

-  Paint 단계에서 생성된 레이어를 합성하여 실제 화면에 나타낸다.

## 리플로우과 리페인트

-  브라우저 로딩 과정 중 스타일 이후 과정 (스타일 -> 레이아웃 -> 페인트 -> 합성)을 렌더링이라고 하는데 해당 과정은 반복하여 발생할 수 있다.


### 리플로우

-  스타일 단계에서 구성되는 렌더트리는 자바스크립트에 의해 DOM 트리, CSSOM 트리가 변경될 때 마다 재구성된다.
-  DOM이 추가/삭제되거나 요소에 기하학적인 영향(높이, 너비, 위치)을 주는 CSS 속성값이 변경되는 경우. 렌더트리가 재구성된다.
-  레이아웃 이후 과정을 다시 수행는 것을 리플로우라고 한다.
-  CSS 속성값 : `height`, `width`, `left`, `top`, `font-size`, `line-height` 등

![image](https://user-images.githubusercontent.com/60173534/226915246-f9a9c3bc-372f-491c-8331-e8a296c59e9f.png)

### 리페인트

-  리플로우는 기하학적인 영향을 주는 CSS 속성값이 변경할 때 발생한다.
   반대로 영향을 주지 않는 CSS 속성값을 변경하면 레이아웃 과정을 건넊뀐다.
-  즉, 레이아웃 과정을 건너뛰고 페인트 과정만 수행하는 것을 리페인트라고 한다.
-  CSS 속성값 : `background-color`, `color`, `visibility`, `text-decoration` 등

![image](https://user-images.githubusercontent.com/60173534/226915255-21e9e18d-d406-4b73-8340-184ddde8fa1f.png)
